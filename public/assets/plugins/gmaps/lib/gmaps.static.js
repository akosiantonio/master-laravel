GMaps.prototype.toImage=function(e){var e=e||{},t={};if(t.size=e.size||[this.el.clientWidth,this.el.clientHeight],t.lat=this.getCenter().lat(),t.lng=this.getCenter().lng(),this.markers.length>0){t.markers=[];for(var r=0;r<this.markers.length;r++)t.markers.push({lat:this.markers[r].getPosition().lat(),lng:this.markers[r].getPosition().lng()})}if(this.polylines.length>0){var s=this.polylines[0];t.polyline={},t.polyline.path=google.maps.geometry.encoding.encodePath(s.getPath()),t.polyline.strokeColor=s.strokeColor,t.polyline.strokeOpacity=s.strokeOpacity,t.polyline.strokeWeight=s.strokeWeight}return GMaps.staticMapURL(t)},GMaps.staticMapURL=function(e){function t(e,t){if("#"===e[0]&&(e=e.replace("#","0x"),t)){if(t=parseFloat(t),t=Math.min(1,Math.max(t,0)),0===t)return"0x00000000";t=(255*t).toString(16),1===t.length&&(t+=t),e=e.slice(0,8)+t}return e}var r,s=[],l=("file:"===location.protocol?"http:":location.protocol)+"//maps.googleapis.com/maps/api/staticmap";e.url&&(l=e.url,delete e.url),l+="?";var o=e.markers;delete e.markers,!o&&e.marker&&(o=[e.marker],delete e.marker);var i=e.styles;delete e.styles;var a=e.polyline;if(delete e.polyline,e.center)s.push("center="+e.center),delete e.center;else if(e.address)s.push("center="+e.address),delete e.address;else if(e.lat)s.push(["center=",e.lat,",",e.lng].join("")),delete e.lat,delete e.lng;else if(e.visible){var n=encodeURI(e.visible.join("|"));s.push("visible="+n)}var p=e.size;p?(p.join&&(p=p.join("x")),delete e.size):p="630x300",s.push("size="+p),e.zoom||e.zoom===!1||(e.zoom=15);var h=e.hasOwnProperty("sensor")?!!e.sensor:!0;delete e.sensor,s.push("sensor="+h);for(var c in e)e.hasOwnProperty(c)&&s.push(c+"="+e[c]);if(o)for(var u,d,g=0;r=o[g];g++){u=[],r.size&&"normal"!==r.size?(u.push("size:"+r.size),delete r.size):r.icon&&(u.push("icon:"+encodeURI(r.icon)),delete r.icon),r.color&&(u.push("color:"+r.color.replace("#","0x")),delete r.color),r.label&&(u.push("label:"+r.label[0].toUpperCase()),delete r.label),d=r.address?r.address:r.lat+","+r.lng,delete r.address,delete r.lat,delete r.lng;for(var c in r)r.hasOwnProperty(c)&&u.push(c+":"+r[c]);u.length||0===g?(u.push(d),u=u.join("|"),s.push("markers="+encodeURI(u))):(u=s.pop()+encodeURI("|"+d),s.push(u))}if(i)for(var g=0;g<i.length;g++){var f=[];i[g].featureType&&f.push("feature:"+i[g].featureType.toLowerCase()),i[g].elementType&&f.push("element:"+i[g].elementType.toLowerCase());for(var m=0;m<i[g].stylers.length;m++)for(var v in i[g].stylers[m]){var y=i[g].stylers[m][v];("hue"==v||"color"==v)&&(y="0x"+y.substring(1)),f.push(v+":"+y)}var k=f.join("|");""!=k&&s.push("style="+k)}if(a){if(r=a,a=[],r.strokeWeight&&a.push("weight:"+parseInt(r.strokeWeight,10)),r.strokeColor){var z=t(r.strokeColor,r.strokeOpacity);a.push("color:"+z)}if(r.fillColor){var C=t(r.fillColor,r.fillOpacity);a.push("fillcolor:"+C)}var j=r.path;if(j.join)for(var b,m=0;b=j[m];m++)a.push(b.join(","));else a.push("enc:"+j);a=a.join("|"),s.push("path="+encodeURI(a))}var w=window.devicePixelRatio||1;return s.push("scale="+w),s=s.join("&"),l+s};