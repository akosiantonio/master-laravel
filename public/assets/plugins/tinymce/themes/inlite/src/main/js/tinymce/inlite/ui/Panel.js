/**
 * Panel.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2016 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
define("tinymce/inlite/ui/Panel",["global!tinymce.util.Tools","global!tinymce.ui.Factory","global!tinymce.DOM","tinymce/inlite/ui/Toolbar","tinymce/inlite/ui/Forms","tinymce/inlite/core/Measure","tinymce/inlite/core/Layout"],function(e,t,n,i,o,r,c){return function(){var l,a,s="bold italic | quicklink h2 h3 blockquote",u="quickimage quicktable",f=function(t,n){return e.map(n,function(e){return i.create(t,e.id,e.items)})},g=function(e){var t=e.selection_toolbar;return t?t:s},m=function(e){var t=e.insert_toolbar;return t?t:u},h=function(e,n){var r,c=e.settings;return r=f(e,n),r=r.concat([i.create(e,"text",g(c)),i.create(e,"insert",m(c)),o.createQuickLinkForm(e,x)]),t.create({type:"floatpanel",role:"dialog",classes:"tinymce tinymce-inline arrow",ariaLabel:"Inline toolbar",layout:"flex",direction:"column",align:"stretch",autohide:!1,autofix:!0,fixed:!0,border:1,items:r,oncancel:function(){e.focus()}})},b=function(e){e&&e.show()},d=function(e,t){e.moveTo(t.x,t.y)},y=function(t,n){n=n?n.substr(0,2):"",e.each({t:"down",b:"up",c:"center"},function(e,i){t.classes.toggle("arrow-"+e,i===n.substr(0,1))}),"cr"===n?(t.classes.toggle("arrow-left",!0),t.classes.toggle("arrow-right",!1)):"cl"===n?(t.classes.toggle("arrow-left",!0),t.classes.toggle("arrow-right",!0)):e.each({l:"left",r:"right"},function(e,i){t.classes.toggle("arrow-"+e,i===n.substr(1,1))})},v=function(e,t){var n=e.items().filter("#"+t);n.length>0&&(n[0].show(),e.reflow())},w=function(e,t,i,o){var l,s,u,f;b(e),e.items().hide(),v(e,t),f=i.settings.inline_toolbar_position_handler,l=r.getContentAreaRect(i),s=n.getRect(e.getEl()),u="insert"===t?c.calcInsert(o,l,s):c.calc(o,l,s),u?(s=u.rect,a=o,d(e,c.userConstrain(f,o,l,s)),y(e,u.position)):x(e)},p=function(){return l.items().filter("form:visible").length>0},_=function(e,t){if(l){l.items().hide(),v(l,t);var i,o,s,u;b(l),l.items().hide(),v(l,t),u=e.settings.inline_toolbar_position_handler,i=r.getContentAreaRect(e),o=n.getRect(l.getEl()),s=c.calc(a,i,o),s&&(o=s.rect,d(l,c.userConstrain(u,a,i,o)),y(l,s.position))}},k=function(e,t,n,i){l||(l=h(e,i),l.renderTo(document.body).reflow().moveTo(n.x,n.y),e.nodeChanged()),w(l,t,e,n)},x=function(){l&&l.hide()},q=function(){l&&l.find("toolbar:visible").eq(0).each(function(e){e.focus(!0)})},C=function(){l&&(l.remove(),l=null)},F=function(){return l&&l.visible()&&p()};return{show:k,showForm:_,inForm:F,hide:x,focus:q,remove:C}}});